(this.webpackJsonpcomputeshader=this.webpackJsonpcomputeshader||[]).push([[0],{16:function(e,t,n){},18:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(2),a=n.n(i),o=n(9),c=n.n(o),u=(n(16),n(10)),s=n(1),f=n.n(s),l=n(6),h=n(3),p=n(7);function d(e,t){return function(e){return Object(p.a)(Array(e).keys())}(t.length/e).map((function(n){return t.slice(e*n,e*(n+1))}))}function g(e,t){return d(e,function(e){return d(4,e).map((function(e){var t=Object(p.a)(e),n=t[0];return t[1],t[2],n}))}(t))}function m(e,t){return b.apply(this,arguments)}function b(){return(b=Object(h.a)(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.createTexture(),t.bindTexture(t.TEXTURE_2D,r),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),T(n.width)&&T(n.height)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return 0==(e&e-1)}function x(e,t){return{type:"image",name:e,image:t}}function E(e,t){return{type:"uniform1f",name:e,value:t}}function v(e,t){var n=Object(l.a)(t,2);return{type:e,w:n[0],h:n[1]}}function _(e,t,n){var r=Object(l.a)(e,2);return{vs:r[0],fs:r[1],result:t,variables:n}}function j(e,t){var n=Object(l.a)(t,2),r=n[0],i=n[1],a=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,r),e.shaderSource(o,i),e.compileShader(a),console.log(e.getShaderInfoLog(a)),e.compileShader(o),console.log(e.getShaderInfoLog(o));var c=e.createProgram();return e.attachShader(c,a),e.attachShader(c,o),e.linkProgram(c),e.useProgram(c),c}function R(e,t){return O.apply(this,arguments)}function O(){return(O=Object(h.a)(f.a.mark((function e(t,n){var r,i,a,o,c,s,l,h,p,d,g;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.result,i=n.vs,a=n.fs,o=n.variables,t.width=r.w,t.height=r.h,c=t.getContext("webgl2"),s=j(c,[i,a]),l=c.getAttribLocation(s,"position"),A(c,l),h=0,p=Object(u.a)(o),e.prev=9,p.s();case 11:if((d=p.n()).done){e.next=27;break}g=d.value,e.t0=g.type,e.next="uniform1f"===e.t0?16:"array2D"===e.t0?18:"image"===e.t0?21:25;break;case 16:return y(c,s,g),e.abrupt("continue",25);case 18:return e.next=20,w(c,s,g,h);case 20:return e.abrupt("continue",25);case 21:return e.next=23,U(c,s,g,h);case 23:return++h,e.abrupt("continue",25);case 25:e.next=11;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(9),p.e(e.t1);case 32:return e.prev=32,p.f(),e.finish(32);case 35:return e.abrupt("return",{gl:c,program:s});case 36:case"end":return e.stop()}}),e,null,[[9,29,32,35]])})))).apply(this,arguments)}function A(e,t){var n=e.createBuffer(e.ARRAY_BUFFER);e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,-1]),e.STATIC_DRAW),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,2,e.FLOAT,!1,0,0)}function y(e,t,n){var r=n.name,i=n.value,a=e.getUniformLocation(t,r);e.uniform1f(a,i)}function w(e,t,n,r){var i=n.name,a=n.data,o=n.w,c=n.h,u=e.createTexture(),s=e.getUniformLocation(t,i);e.bindTexture(e.TEXTURE_2D,u),console.log({data:a}),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA8,o,c,0,e.RGBA,e.UNSIGNED_BYTE,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.uniform1i(s,r)}function U(e,t,n,r){return D.apply(this,arguments)}function D(){return(D=Object(h.a)(f.a.mark((function e(t,n,r,i){var a,o,c,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.name,o=r.image,t.activeTexture(t.TEXTURE0+i),e.next=4,m(t,o);case 4:c=e.sent,console.log(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)),t.bindTexture(t.TEXTURE_2D,c),u=t.getUniformLocation(n,a),console.log(a,i),t.uniform1i(u,i);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){return S.apply(this,arguments)}function S(){return(S=Object(h.a)(f.a.mark((function e(t,n){var r,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t,n);case 2:return r=e.sent,i=r.gl,a=n.result,i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT),i.drawArrays(i.TRIANGLE_FAN,0,4),e.abrupt("return",(function(){var e=new Uint8Array(a.w*a.h*4);switch(i.readPixels(0,0,a.w,a.h,i.RGBA,i.UNSIGNED_BYTE,e),a.type){default:case"uint8":return e;case"float32":return new Float32Array(e.buffer);case"int32":return new Int32Array(e.buffer)}}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P="\n  #version 300 es\n  in vec4 position;\n  void main() {\n    gl_Position = position;\n  }\n".trim(),X="\n  #version 300 es\n  precision mediump float;\n\n  float greyScale(vec3 x) {\n    return dot(x, vec3( 0.2125, 0.7154, 0.0721 ));\n  }\n\n  int bucketOf(vec3 x, vec3 y) {\n    float a = greyScale(x);\n    float b = greyScale(y);\n    int low = int(floor(a * 7.0));\n    int high = int(floor(b * 7.0)) << 3;\n    return low | high;\n  }\n\n  float entropyOf(int count, int total) {\n    if (count == 0) {\n      return 0.0;\n    } else {\n      float p = float(count) / (float(total));\n      return -p*log(p);\n    }\n  }\n\n  uniform float sp_width;\n  uniform float sp_height;\n\n  uniform float m_width;\n  uniform float m_height;\n\n  uniform sampler2D fixedTex;\n  uniform sampler2D movingTex;\n\n\n  out vec4 result;\n\n\n  void main() {\n\n    ivec2 offset = ivec2(\n      gl_FragCoord.x,\n      sp_height - gl_FragCoord.y\n    );\n\n    int buckets[64];\n    for (int i = 0; i < 64; ++i) {\n      buckets[i] = 0;\n    }\n\n    for (int i = 0; i < int(m_width); ++i) {\n      for (int j = 0; j < int(m_height); ++j) {\n        ivec2 uv = ivec2(i, j);\n        vec3 fixedImg = texelFetch(fixedTex,  offset+uv, 0).rgb;\n        vec3 movingImg = texelFetch(movingTex, uv, 0).rgb;\n        int bucketId = bucketOf(fixedImg, movingImg);\n        buckets[bucketId] += 1;\n      }\n    } \n\n    int total = 0;\n    for (int i = 0; i < 64; ++i) {\n      total += buckets[i];\n    }\n\n\n    float entropy  = 0.0;\n    for (int i = 0; i < 64; ++i) {\n      entropy += entropyOf(buckets[i], total);\n    }\n\n    vec3 color=vec3(entropy*0.2);\n\n\n    result = vec4(color, 1);\n  }\n".trim();function k(e){var t=e.fixedUrl,n=void 0===t?"butterfly2.jpg":t,a=e.movingUrl,o=void 0===a?"butterfly3.jpg":a,c=Object(i.useRef)(null),u=(Object(i.useRef)(null),Object(i.useRef)(null)),s=Object(i.useRef)(null);return Object(i.useEffect)((function(){setTimeout(Object(h.a)(f.a.mark((function e(){var t,n,r,i,a,o,l,h,p,d,m,b,T,j,R,O,A;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[u.current,s.current],n=t[0],r=t[1],e.next=3,new Promise((function(e){return setTimeout(e,300)}));case 3:return i=[n.width-r.width,n.height-r.height],a=_([P,X],v("uint8",i),[E("sp_width",i[0]),E("sp_height",i[1]),E("m_width",r.width),E("m_height",r.height),x("fixedTex",n),x("movingTex",r)]),o=c.current,l=Date.now(),e.next=9,I(o,a);case 9:h=e.sent,p=Date.now(),d=h(),m=Date.now(),b=p-l,T=m-p,j=i[0]*i[1],R=j*n.width*n.height,console.log({time:b,uploadTime:T,searchSpace:i,fixed:[n.width,n.height],moving:[r.width,r.height],iterations:j,pixelsCompared:R,itersPerSecond:j/b*1e3,pixelsPerSecond:R/b*1e3}),O=g(i[0],d),A=O.flatMap((function(e,t){return e.map((function(e,n){return{value:e,y:t,x:n}}))})).sort((function(e,t){return e.value-t.value})),console.log({topResults5:A.slice(0,5)});case 21:case"end":return e.stop()}}),e)}))),0)}),[n,o]),Object(r.jsx)("div",{children:Object(r.jsxs)("div",{style:{display:"flex"},children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"Fixed Image (haystack)"}),Object(r.jsx)("img",{src:n,ref:u})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"Moving Image (needle)"}),Object(r.jsx)("img",{src:o,ref:s})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"SearchSpace (darker is better) "}),Object(r.jsx)("canvas",{ref:c})]})]})})}function F(){return Object(r.jsxs)("div",{children:[Object(r.jsx)("h1",{children:" Image Alignment with WebGL "}),Object(r.jsxs)("div",{children:['Goal: find "moving image" inside "fixed image".',Object(r.jsx)("br",{}),"SearchSpace visualization shows how good the images are aligned at each x-y coordinate. Darker is better.",Object(r.jsx)("br",{}),"Open console for performance metrics and results (ctrl+shift+i)"]}),Object(r.jsx)(k,{fixedUrl:"butterfly2.jpg",movingUrl:"butterfly3.jpg"}),Object(r.jsx)(k,{fixedUrl:"butterfly2.jpg",movingUrl:"butterfly4.jpg"}),Object(r.jsx)(k,{fixedUrl:"butterfly2.jpg",movingUrl:"butterfly5.jpg"})]})}var L=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,19)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),i(e),a(e),o(e)}))};c.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(F,{})}),document.getElementById("root")),L()}},[[18,1,2]]]);
//# sourceMappingURL=main.9a7e1c09.chunk.js.map